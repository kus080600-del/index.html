<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>365天優雅儲蓄挑戰</title>
    <!-- 引入 Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --azure: #F0F8FF;
            --gold: #D4AF37;
            --deep-blue: #1A365D;
        }

        body {
            background-color: var(--azure);
            font-family: 'Noto Serif TC', serif;
            color: var(--deep-blue);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        h1, h2, .font-serif-en {
            font-family: 'Cinzel', serif;
        }

        /* 歐式邊框裝飾 */
        .ornate-border {
            border: 2px solid var(--gold);
            position: relative;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .ornate-border::before, .ornate-border::after {
            content: "✧";
            position: absolute;
            color: var(--gold);
            font-size: 20px;
        }
        .ornate-border::before { top: 5px; left: 5px; }
        .ornate-border::after { bottom: 5px; right: 5px; }

        /* 卡片網格與動畫 */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
            gap: 8px;
            padding: 10px;
        }

        .save-card {
            aspect-ratio: 1/1;
            perspective: 1000px;
            cursor: pointer;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .save-card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 12px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        .card-front {
            background: linear-gradient(135deg, #fff 0%, #e6f2ff 100%);
            color: var(--gold);
            font-weight: bold;
        }

        .card-back {
            background: var(--gold);
            color: white;
            transform: rotateY(180deg);
            font-size: 10px;
            flex-direction: column;
        }

        /* 進度條 */
        .progress-bar-bg {
            background: #e2e8f0;
            height: 10px;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar-fill {
            background: linear-gradient(90deg, var(--gold), #f6e05e);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* 煙火 Canvas */
        #fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        /* 玻璃擬態 */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-gold {
            background: var(--gold);
            color: white;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-gold:hover {
            filter: brightness(1.1);
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <canvas id="fireworks"></canvas>

    <div class="max-w-2xl mx-auto">
        <!-- 標題區 -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold mb-2 tracking-widest">365 DAYS CHALLENGE</h1>
            <p class="text-sm opacity-70 italic font-serif-en">The Art of Persistence & Wealth</p>
        </header>

        <!-- 許願池與統計 -->
        <section class="glass ornate-border mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-xs font-bold mb-1 opacity-60">我的願望 My Wish</label>
                    <input type="text" id="wishName" placeholder="例如：倫敦之旅" class="bg-transparent border-b border-gold w-full py-1 outline-none text-lg">
                    
                    <label class="block text-xs font-bold mt-4 mb-1 opacity-60">目標金額 Target Amount</label>
                    <input type="number" id="targetAmount" placeholder="100000" class="bg-transparent border-b border-gold w-full py-1 outline-none text-lg font-serif-en">
                </div>
                <div class="flex flex-col justify-end">
                    <div class="flex justify-between text-sm mb-1">
                        <span>達成進度</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar-bg mb-2">
                        <div id="progressBar" class="progress-bar-fill"></div>
                    </div>
                    <div class="text-right text-xs opacity-60">
                        累計儲蓄: $<span id="totalSavings">0</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 激勵文案區 -->
        <section class="mb-8 text-center px-4">
            <p id="quoteText" class="text-sm italic mb-1">「每一次小小的儲蓄，都是對未來生活的一張選票。」</p>
            <p id="luckyTip" class="text-xs text-gold">開運建議：穿戴淺藍色飾品能增強今日財運。</p>
        </section>

        <!-- 操作區 -->
        <div class="flex justify-center mb-8">
            <button onclick="drawCard()" class="btn-gold px-10 py-3 rounded-full shadow-lg font-bold flex items-center gap-2">
                <span>✧</span> 抽卡儲蓄 <span>✧</span>
            </button>
        </div>

        <!-- 儲蓄格 -->
        <div class="glass p-4 rounded-xl mb-12">
            <div class="flex justify-between items-center px-2 mb-4">
                <h3 class="font-serif-en text-lg font-bold">Progress Grid</h3>
                <span class="text-xs opacity-60">已完成: <span id="completedDays">0</span> / 365 天</span>
            </div>
            <div id="grid" class="grid-container">
                <!-- 由 JS 生成 365 個格子 -->
            </div>
        </div>

        <!-- 底部控制 -->
        <footer class="mt-12 text-center pb-12">
            <button onclick="confirmReset()" class="text-xs opacity-40 hover:opacity-100 transition-opacity flex items-center gap-1 mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                重置所有挑戰進度
            </button>
        </footer>
    </div>

    <!-- 音效資源 (使用 Web Audio API 生成簡單音效，避免外部連結失效) -->
    <script>
        const STORAGE_KEY = 'saving_challenge_data';
        let state = {
            total: 0,
            wish: '',
            target: 50000,
            history: [] // 儲存 {dayIndex, amount, date}
        };

        const quotes = [
            "財富不是一蹴而就的，而是點滴累積的成果。",
            "自律是通往自由的唯一途徑。",
            "今天的努力，是為了明天有選擇的權利。",
            "每一個銅板都帶著實現夢想的可能。",
            "耐心與持久勝過激烈的狂熱。"
        ];

        const luckyTips = [
            "今日宜整理錢包，讓金錢流動更順暢。",
            "試著在左手腕繫一條藍色絲線，有助聚財。",
            "今日幸運色：淡金色。適合思考理財計劃。",
            "在辦公桌放一杯清水，能提升工作專注度與財運。",
            "微笑是最好的招財咒語，對鏡子笑一下吧。"
        ];

        // 初始化
        window.onload = () => {
            loadState();
            renderGrid();
            updateUI();
            
            // 監聽輸入存檔
            document.getElementById('wishName').addEventListener('input', (e) => {
                state.wish = e.target.value;
                saveState();
            });
            document.getElementById('targetAmount').addEventListener('input', (e) => {
                state.target = parseInt(e.target.value) || 0;
                updateUI();
                saveState();
            });
        };

        function renderGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            for (let i = 1; i <= 365; i++) {
                const card = document.createElement('div');
                card.className = 'save-card';
                card.id = `card-${i}`;
                
                const entry = state.history.find(h => h.dayIndex === i);
                if (entry) card.classList.add('flipped');

                card.innerHTML = `
                    <div class="card-inner">
                        <div class="card-front">${i}</div>
                        <div class="card-back">
                            <span style="font-size: 8px opacity: 0.7">DAY ${i}</span>
                            <span class="font-bold">$${entry ? entry.amount : ''}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            }
        }

        function drawCard() {
            // 尋找尚未翻開的最小天數
            const usedDays = state.history.map(h => h.dayIndex);
            let nextDay = 1;
            while(usedDays.includes(nextDay) && nextDay <= 365) {
                nextDay++;
            }

            if (nextDay > 365) {
                alert("恭喜！你已經完成了 365 天的所有挑戰！");
                return;
            }

            // 隨機金額 50 - 300
            const amount = Math.floor(Math.random() * (300 - 50 + 1)) + 50;
            
            // 更新狀態
            state.history.push({
                dayIndex: nextDay,
                amount: amount,
                date: new Date().toISOString()
            });
            state.total += amount;

            // 執行翻牌與特效
            const card = document.getElementById(`card-${nextDay}`);
            card.querySelector('.card-back .font-bold').innerText = `$${amount}`;
            card.classList.add('flipped');
            
            playMagicSound();
            createFireworks();
            updateUI();
            saveState();

            // 更新金句
            document.getElementById('quoteText').innerText = `「${quotes[Math.floor(Math.random()*quotes.length)]}」`;
            document.getElementById('luckyTip').innerText = `開運建議：${luckyTips[Math.floor(Math.random()*luckyTips.length)]}`;
        }

        function updateUI() {
            document.getElementById('wishName').value = state.wish;
            document.getElementById('targetAmount').value = state.target;
            document.getElementById('totalSavings').innerText = state.total.toLocaleString();
            document.getElementById('completedDays').innerText = state.history.length;

            const percent = state.target > 0 ? Math.min(Math.round((state.total / state.target) * 100), 100) : 0;
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('progressPercent').innerText = `${percent}%`;
        }

        function saveState() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        }

        function loadState() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                state = JSON.parse(saved);
            }
        }

        function confirmReset() {
            if (confirm("確定要重置所有數據嗎？這將刪除所有儲蓄紀錄且無法恢復。")) {
                state = { total: 0, wish: '', target: 50000, history: [] };
                saveState();
                location.reload();
            }
        }

        // 音效產生器
        function playMagicSound() {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(440, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
            osc.frequency.exponentialRampToValueAtTime(1320, ctx.currentTime + 0.2);

            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.3);

            osc.connect(gain);
            gain.connect(ctx.destination);

            osc.start();
            osc.stop(ctx.currentTime + 0.3);
        }

        // 煙火特效
        const canvas = document.getElementById('fireworks');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function createFireworks() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    size: Math.random() * 3 + 2,
                    color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                    life: 100
                });
            }
            animate();
        }

        function animate() {
            if (particles.length === 0) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.1; // 重力
                p.life--;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>