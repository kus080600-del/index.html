<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>365å¤©éŒ¢éŒ¢å¤§é€ƒæ®º</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="éŒ¢éŒ¢å¤§é€ƒæ®º">
    
    <style>
        :root {
            --gold-main: #B8860B; /* é‡‘è¤è‰² */
            --gold-light: #DAA520;
            --bg-dark: #1A1A1A;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        body {
            background-color: var(--bg-dark);
            color: #E0E0E0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: calc(var(--safe-top) + 20px) 15px calc(var(--safe-bottom) + 40px);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* çµ±è¨ˆçœ‹æ¿ */
        .stats-card {
            background: linear-gradient(135deg, #333, #222);
            border: 1px solid var(--gold-main);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        #wish-name {
            background: transparent;
            border: none;
            border-bottom: 1px solid #444;
            color: var(--gold-light);
            font-size: 1.4rem;
            font-weight: bold;
            width: 100%;
            margin-bottom: 15px;
            outline: none;
        }

        .progress-bar {
            height: 12px;
            background: #444;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0;
        }

        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold-main), var(--gold-light));
            width: 0%;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ç¶²æ ¼ç³»çµ± */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }

        .grid-item {
            aspect-ratio: 1/1;
            background: #2A2A2A;
            border: 1px solid #333;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #666;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .grid-item:active {
            transform: scale(0.9);
        }

        .grid-item.completed {
            background: linear-gradient(145deg, var(--gold-main), #8B6508);
            border: none;
            color: #fff;
            font-weight: bold;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }

        /* Modal å½ˆçª— */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-content {
            background: #2A2A2A;
            border: 2px solid var(--gold-light);
            width: 100%;
            max-width: 350px;
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            position: relative;
            animation: modalPop 0.3s ease-out;
        }

        @keyframes modalPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .amount-display {
            font-size: 3rem;
            color: var(--gold-light);
            margin: 15px 0;
            text-shadow: 0 0 15px rgba(218, 165, 32, 0.4);
        }

        .ai-btn {
            background: var(--gold-main);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 20px;
            width: 100%;
        }

        .close-btn {
            margin-top: 15px;
            color: #888;
            background: none;
            border: none;
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="stats-card">
    <input type="text" id="wish-name" placeholder="é€™å ´å¤§é€ƒæ®ºçš„æˆ°åˆ©å“æ˜¯...ï¼Ÿ" onchange="saveData()">
    <div style="display:flex; justify-content: space-between; font-size: 0.9rem;">
        <span>æˆ°åˆ©å“ç¸½è¨ˆï¼š$<span id="total-amount">0</span></span>
        <span>ç”Ÿå­˜é€²åº¦ï¼š<span id="percent">0</span>%</span>
    </div>
    <div class="progress-bar"><div id="progress-fill"></div></div>
    <p style="font-size: 0.8rem; color: #888; margin: 5px 0 0;">å·²æŒºéï¼š<span id="days-count">0</span> / 365 å¤©</p>
</div>

<div class="grid-container" id="grid"></div>

<div id="modal" class="modal">
    <div class="modal-content">
        <div style="font-size: 0.9rem; color: #888;">ä»Šæ—¥æ å¥ªé‡‘é¡</div>
        <h2 id="modal-amount" class="amount-display">$0</h2>
        <p id="modal-quote" style="line-height: 1.6; color: #EEE; min-height: 3em;"></p>
        
        <div id="modal-tips" style="text-align: left; font-size: 0.85rem; background: #222; padding: 15px; border-radius: 10px; margin-top: 10px;">
        </div>

        <button class="ai-btn" onclick="callGemini()">âœ¨ ç²å–æŒ‡æ®å®˜æŒ‡ä»¤</button>
        <button class="close-btn" onclick="closeModal()">æˆ‘å·²æ”¶ä¸‹é‡‘é¡</button>
    </div>
</div>

<script>
const apiKey = ""; // ç³»çµ±å°‡è‡ªå‹•å¡«å…¥
let storageData = JSON.parse(localStorage.getItem('battleRoyale365')) || {
    wish: "", 
    total: 0, 
    completedDays: {}, 
    daysCount: 0
};

const quotes = [
    "åœ¨é‡‘éŒ¢çš„ä¸–ç•Œè£¡ï¼Œåªæœ‰æ´»ä¸‹ä¾†çš„äººæ‰æ˜¯è´å®¶ã€‚",
    "æ¯ä¸€å¡ŠéŒ¢éƒ½æ˜¯ä½ é˜²ç¦¦æœªä¾†çš„å­å½ˆã€‚",
    "é€™ä¸æ˜¯å„²è“„ï¼Œé€™æ˜¯ä½ é€šå¾€è‡ªç”±çš„é€ƒç”Ÿé€šé“ã€‚"
];

const luckTips = [
    "ã€è²¡ä½æé†’ã€‘æ¸…ç†æˆ¿é–“æ±å—æ–¹ï¼Œè®“è²¡æ°£æµå‹•ã€‚",
    "ã€ç”Ÿå­˜å„€å¼ã€‘ä»Šå¤©çµå¸³æ™‚è«‹ä½¿ç”¨é›»å­æ”¯ä»˜ï¼Œç²¾ç¢ºè¨˜éŒ„æ¯ä¸€åˆ†æµå‘ã€‚",
    "ã€è‰²å½©æˆ°è¡“ã€‘ç©¿æˆ´é»‘è‰²ç³»æœé£¾ï¼Œæ²‰ç©©å®ˆä½ä½ çš„è²¡åº«ã€‚",
    "ã€å¿ƒç†æš—ç¤ºã€‘å°è‡ªå·±èªªï¼šæˆ‘æœ‰èƒ½åŠ›æŒæ§æ¯ä¸€åˆ†è³‡æºã€‚"
];

// åˆå§‹åŒ–
function init() {
    const grid = document.getElementById('grid');
    for (let i = 1; i <= 365; i++) {
        const item = document.createElement('div');
        item.className = 'grid-item';
        item.id = `day-${i}`;
        item.innerText = i;
        item.onclick = () => openGrid(i);
        grid.appendChild(item);
    }
    updateUI();
}

function openGrid(day) {
    if (storageData.completedDays[day]) return;

    // éš¨æ©Ÿé‡‘é¡ 50 - 300
    const amount = Math.floor(Math.random() * (300 - 50 + 1)) + 50;
    
    storageData.completedDays[day] = amount;
    storageData.total += amount;
    storageData.daysCount += 1;

    document.getElementById('modal-amount').innerText = `$${amount}`;
    document.getElementById('modal-quote').innerText = quotes[Math.floor(Math.random() * quotes.length)];
    document.getElementById('modal-tips').innerHTML = `<b>ğŸ›¡ï¸ ç”Ÿå­˜æç¤ºï¼š</b><br>${luckTips[Math.floor(Math.random() * luckTips.length)]}`;
    
    document.getElementById('modal').style.display = 'flex';
    updateUI();
    saveData();
}

function updateUI() {
    document.getElementById('total-amount').innerText = storageData.total.toLocaleString();
    document.getElementById('days-count').innerText = storageData.daysCount;
    document.getElementById('wish-name').value = storageData.wish;
    
    // è¨ˆç®—ç™¾åˆ†æ¯” (ä»¥ 50,000 ç‚ºé è¨­ç›®æ¨™)
    const progress = Math.min((storageData.total / 50000) * 100, 100);
    document.getElementById('progress-fill').style.width = progress + '%';
    document.getElementById('percent').innerText = Math.floor(progress);
    
    // æ¸²æŸ“æ ¼å­ç‹€æ…‹
    for (let i = 1; i <= 365; i++) {
        const el = document.getElementById(`day-${i}`);
        if (storageData.completedDays[i]) {
            el.classList.add('completed');
            el.innerText = `$${storageData.completedDays[i]}`;
        }
    }
}

function saveData() {
    storageData.wish = document.getElementById('wish-name').value;
    localStorage.setItem('battleRoyale365', JSON.stringify(storageData));
}

function closeModal() {
    document.getElementById('modal').style.display = 'none';
    saveData();
}

// Gemini AI ä¸²æ¥
async function callGemini() {
    if (!apiKey) {
        alert("å°šæœªåµæ¸¬åˆ° API Keyï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
        return;
    }
    const btn = document.querySelector('.ai-btn');
    const quoteEl = document.getElementById('modal-quote');
    
    btn.disabled = true;
    btn.innerText = "å‚³è¼¸æŒ‡ä»¤ä¸­...";
    
    const prompt = `ä½ æ˜¯ä¸€ä½ã€ŒéŒ¢éŒ¢å¤§é€ƒæ®ºã€ç”Ÿå­˜éŠæˆ²çš„æŒ‡æ®å®˜ã€‚è«‹çµ¦æˆ‘ä¸€æ®µçŸ­å°çš„ç¹é«”ä¸­æ–‡æŒ‡ä»¤ï¼Œé¼“å‹µæˆ‘å®Œæˆä»Šå¤©çš„å„²è“„æŒ‘æˆ°ï¼Œèªæ°£è¦å†·é…·ä½†æ¥µå…·æ¿€å‹µæ€§ã€‚å­—æ•¸é™åˆ¶25å­—å…§ã€‚`;
    
    try {
        const response = await fetchWithRetry(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${apiKey}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });
        const data = await response.json();
        quoteEl.innerText = `ã€Œ${data.candidates[0].content.parts[0].text}ã€`;
    } catch (e) {
        quoteEl.innerText = "ã€Œåˆ¥åœ¨æˆ°å ´ä¸Šç™¼å‘†ï¼Œå­˜ä¸‹é€™ç­†éŒ¢ï¼Œä½ æ‰èƒ½æ´»åˆ°æœ€å¾Œã€‚ã€";
    } finally {
        btn.disabled = false;
        btn.innerText = "âœ¨ ç²å–æŒ‡æ®å®˜æŒ‡ä»¤";
    }
}

// æŒ‡æ•¸é€€é¿é‡è©¦æ©Ÿåˆ¶
async function fetchWithRetry(url, options, retries = 5, backoff = 300) {
    try {
        const res = await fetch(url, options);
        if (!res.ok) throw res;
        return res;
    } catch (err) {
        if (retries <= 1) throw err;
        await new Promise(r => setTimeout(r, backoff));
        return fetchWithRetry(url, options, retries - 1, backoff * 2);
    }
}

window.onload = init;
</script>
</body>
</html>
